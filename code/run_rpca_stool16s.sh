#to run RPCA you need to be in environment qiime2-2021.4

#NASH ZT13 FT
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_ZT13_FT_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_ZT13_FT
#comparison=collection_disease_stage
#comparison2=NASH_category_new
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH ZT1 FT
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_ZT1_FT_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_ZT1_FT
#comparison=collection_disease_stage
#comparison2=NASH_category_new
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH ZT13 FA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_ZT13_FA_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_ZT13_FA
#comparison=collection_disease_stage
#comparison2=NASH_category_new
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH ZT1 FA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_ZT1_FA_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_ZT1_FA
#comparison=collection_disease_stage
#comparison2=NASH_category_new
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH ZT13 NA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_ZT13_NA_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_ZT13_NA
#comparison=collection_disease_stage

#NASH ZT1 NA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_ZT1_NA_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_ZT1_NA
#comparison=collection_disease_stage

#NASH FT (12wk, NASH)
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_NASH_FT_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_12wk_FT
#comparison=collection_timepoint
#comparison2=NASH_category
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH FA (12wk, NASH)
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_NASH_FA_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_12wk_FA
#comparison=collection_timepoint
#comparison2=NASH_category
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH NA (12wk, NASH)
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_NASH_NA_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_12wk_NA
#comparison=collection_timepoint

#Pre-NASH FT (8wk, TRF)
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_TRF_FT_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_8wk_FT
#comparison=collection_timepoint

#Pre-NASH FA (8wk, TRF)
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_TRF_FA_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_8wk_FA
#comparison=collection_timepoint

#Pre-NASH NA (8wk, TRF) 
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_TRF_NA_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_8wk_NA
#comparison=collection_timepoint

#ZT13
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_ZT13_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_ZT13
#comparison=condition
#comparison2=collection_disease_stage
#comparison3=NASH_category_new
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

#ZT1
#$path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_ZT1_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_ZT1
#comparison=condition
#comparison2=collection_disease_stage
#comparison3=NASH_category_new
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

#NASH (12wk,NASH) FAFT
path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785_gg2/NASH_NASH_FAFT_taxonomy_filtered.gg2.asv.counts.qza
md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
output_path=$path/16s/stool/rpca_results/rpca_results_NASH_12wk_FAFT_gg2
comparison=condition
comparison2=collection_timepoint
comparison3=NASH_category
comparison4=fibrosis_stage_new
comparison5=steatosis_grade_new

#NASH (12wk,NASH)
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_NASH_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_12wk
#comparison=condition
#comparison2=collection_timepoint
#comparison3=NASH_category_new
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

#pre-NASH (8wk,TRF)FAFT
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785_gg2/NASH_TRF_FAFT_taxonomy_filtered.gg2.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_8wk_FAFT_gg2
#comparison=condition
#comparison2=collection_timepoint
#comparison3=NASH_category
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

#pre-NASH (8wk,TRF)
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785/NASH_TRF_taxonomy_filtered.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_8wk
#comparison=condition
#comparison2=collection_timepoint
#comparison3=NASH_category_new
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

#all NASH
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/16S/stool/data/rrichter_preprocessed_20211020_ID_13785_gg2/NASH_taxonomy_filtered.gg2.asv.counts.qza
#md_file=$path/16s/stool/metadata_cln_addmoreNASHcat.txt
#output_path=$path/16s/stool/rpca_results/rpca_results_NASH_all_gg2
#comparison=condition
#comparison2=collection_timepoint
#comparison3=NASH_category_new
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

qiime deicode rpca \
  --i-table $mtb_file \
  --p-min-feature-count 0 \
  --p-min-sample-count 0 \
  --o-biplot $output_path/ordination.qza \
  --o-distance-matrix $output_path/distance_matrix.qza

qiime emperor biplot \
  --i-biplot $output_path/ordination.qza \
  --m-sample-metadata-file $md_file \
  --p-ignore-missing-samples \
  --o-visualization $output_path/biplot.qzv

qiime diversity beta-group-significance \
  --i-distance-matrix $output_path/distance_matrix.qza \
  --m-metadata-file $md_file \
  --m-metadata-column $comparison \
  --p-method permanova \
  --p-pairwise \
  --o-visualization $output_path/${comparison}-significance.qzv

qiime diversity beta-group-significance \
  --i-distance-matrix $output_path/distance_matrix.qza \
  --m-metadata-file $md_file \
  --m-metadata-column $comparison2 \
  --p-method permanova \
  --p-pairwise \
  --o-visualization $output_path/${comparison2}-significance.qzv

qiime diversity beta-group-significance \
  --i-distance-matrix $output_path/distance_matrix.qza \
  --m-metadata-file $md_file \
  --m-metadata-column $comparison3 \
  --p-method permanova \
  --p-pairwise \
  --o-visualization $output_path/${comparison3}-significance.qzv

qiime diversity beta-group-significance \
  --i-distance-matrix $output_path/distance_matrix.qza \
  --m-metadata-file $md_file \
  --m-metadata-column $comparison4 \
  --p-method permanova \
  --p-pairwise \
  --o-visualization $output_path/${comparison4}-significance.qzv

qiime diversity beta-group-significance \
  --i-distance-matrix $output_path/distance_matrix.qza \
  --m-metadata-file $md_file \
  --m-metadata-column $comparison5 \
  --p-method permanova \
  --p-pairwise \
  --o-visualization $output_path/${comparison5}-significance.qzv
