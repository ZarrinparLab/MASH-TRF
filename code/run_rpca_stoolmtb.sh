#to run RPCA you need to be in environment qiime2-2021.4

#NASH ZT13 FT
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-ZT13-FT.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_ZT13_FT
#comparison=ATTRIBUTE_disease_stage
#comparison2=NASH_category
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH ZT13 FA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-ZT13-FA.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_ZT13_FA
#comparison=ATTRIBUTE_disease_stage
#comparison2=NASH_category
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH ZT13 NA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/metabolomics/stool/data/filtered_featuretable_allzt_NASH_ZT13_NA.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_ZT13_NA
#comparison=ATTRIBUTE_disease_stage

#NASH ZT1 FT
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-ZT1-FT.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_ZT1_FT
#comparison=ATTRIBUTE_disease_stage
#comparison2=NASH_category
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH ZT1 FA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-ZT1-FA.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_ZT1_FA
#comparison=ATTRIBUTE_disease_stage
#comparison2=NASH_category
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH ZT1 NA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/metabolomics/stool/data/filtered_featuretable_allzt_NASH_ZT1_NA.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_ZT1_NA
#comparison=ATTRIBUTE_disease_stage

#NASH ZT13
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-ZT13.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_ZT13
#comparison=ATTRIBUTE_condition
#comparison2=ATTRIBUTE_disease_stage
#comparison3=NASH_category
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

#NASH ZT1
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-ZT1.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_ZT1
#comparison=ATTRIBUTE_condition
#comparison2=ATTRIBUTE_disease_stage
#comparison3=NASH_category
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

#NASH NASH FT
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-Wk12-FT.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_Wk12_FT
#comparison=ATTRIBUTE_timepoint
#comparison2=NASH_category
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH NASH FA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-Wk12-FA.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_Wk12_FA
#comparison=ATTRIBUTE_timepoint
#comparison2=NASH_category
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH NASH NA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/metabolomics/stool/data/filtered_featuretable_allzt_NASH_NASH_NA.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_Wk12_NA
#comparison=ATTRIBUTE_timepoint

#NASH TRF FT
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-Wk8-FT.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_Wk8_FT
#comparison=ATTRIBUTE_timepoint
#comparison2=NASH_category
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH TRF FA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-Wk8-FA.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_Wk8_FA
#comparison=ATTRIBUTE_timepoint
#comparison2=NASH_category
#comparison3=fibrosis_stage_new
#comparison4=steatosis_grade_new

#NASH TRF NA
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/files_from_KF/STAM-TRF-ileum-cecum-16S-study-13785/metabolomics/stool/data/filtered_featuretable_allzt_NASH_TRF_NA.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_Wk8_NA
#comparison=ATTRIBUTE_timepoint

#NASH NASH FAFT
path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-Wk12-FAFT.qza
md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_Wk12_FAFT
comparison=ATTRIBUTE_condition
comparison2=ATTRIBUTE_timepoint
comparison3=NASH_category
comparison4=fibrosis_stage_new
comparison5=steatosis_grade_new

#NASH NASH
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-Wk12.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_Wk12
#comparison=ATTRIBUTE_condition
#comparison2=ATTRIBUTE_timepoint
#comparison3=NASH_category
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

#NASH TRF FAFT
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-Wk8-FAFT.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_Wk8_FAFT
#comparison=ATTRIBUTE_condition
#comparison2=ATTRIBUTE_timepoint
#comparison3=NASH_category
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

#NASH TRF
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-Wk8.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_Wk8
#comparison=ATTRIBUTE_condition
#comparison2=ATTRIBUTE_timepoint
#comparison3=NASH_category
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

#all NASH
#path=/mnt/zarrinpar/scratch/sfloresr/NASH_KF/
#mtb_file=$path/mtb/stool/data_files/20231108_gnps_run/quantification_table/quantification_table-00000-clean-mash-rmblnk.qza
#md_file=$path/mtb/stool/NASH_stool_metabolomics_metadata_new.txt
#output_path=$path/mtb/stool/rpca_results/rpca_results_NASH_all
#comparison=ATTRIBUTE_condition
#comparison2=ATTRIBUTE_timepoint
#comparison3=NASH_category
#comparison4=fibrosis_stage_new
#comparison5=steatosis_grade_new

qiime deicode rpca \
  --i-table $mtb_file \
  --p-min-feature-count 0 \
  --p-min-sample-count 0 \
  --o-biplot $output_path/ordination.qza \
  --o-distance-matrix $output_path/distance_matrix.qza

qiime emperor biplot \
  --i-biplot $output_path/ordination.qza \
  --m-sample-metadata-file $md_file \
  --p-ignore-missing-samples \
  --o-visualization $output_path/biplot.qzv

qiime diversity beta-group-significance \
  --i-distance-matrix $output_path/distance_matrix.qza \
  --m-metadata-file $md_file \
  --m-metadata-column $comparison \
  --p-method permanova \
  --p-pairwise \
  --o-visualization $output_path/${comparison}-significance.qzv

qiime diversity beta-group-significance \
  --i-distance-matrix $output_path/distance_matrix.qza \
  --m-metadata-file $md_file \
  --m-metadata-column $comparison2 \
  --p-method permanova \
  --p-pairwise \
  --o-visualization $output_path/${comparison2}-significance.qzv

qiime diversity beta-group-significance \
  --i-distance-matrix $output_path/distance_matrix.qza \
  --m-metadata-file $md_file \
  --m-metadata-column $comparison3 \
  --p-method permanova \
  --p-pairwise \
  --o-visualization $output_path/${comparison3}-significance.qzv

qiime diversity beta-group-significance \
  --i-distance-matrix $output_path/distance_matrix.qza \
  --m-metadata-file $md_file \
  --m-metadata-column $comparison4 \
  --p-method permanova \
  --p-pairwise \
  --o-visualization $output_path/${comparison4}-significance.qzv

qiime diversity beta-group-significance \
  --i-distance-matrix $output_path/distance_matrix.qza \
  --m-metadata-file $md_file \
  --m-metadata-column $comparison5 \
  --p-method permanova \
  --p-pairwise \
  --o-visualization $output_path/${comparison5}-significance.qzv
